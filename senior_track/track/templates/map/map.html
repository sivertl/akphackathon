{% load static %}
<!DOCTYPE html>
<html>

<head>
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
	<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>

    <script type="text/javascript" src="{% static 'js/jquery-3.3.1.js' %}"></script>

	<style>
		.leaflet-container {
			margin-left: auto;
			margin-right: auto;
			margin-top: auto;
			margin-bottom: auto;
			height: 100%;
			width: 100%;
			padding: 475px 475px 475px 475px;
		}

		.body-main {
			height: 100%;
			width: 100%;
		}
	</style>

</head>

<body>
	<div class="leaflet-container" id="map"></div>

	<!-- <script src="../node_modules/simpleheat/simpleheat.js"></script>
	<script src="../src/HeatLayer.js"></script> -->

	<!--<script src="http://leaflet.github.io/Leaflet.markercluster/example/realworld.10000.js"></script>-->
	<script>

		if (localStorage.getItem("lastX") == null){
			// init variable/set default variable for item
			var lastX = 0;
		} else {
			var lastX = localStorage.getItem("lastX");
		}

		if (localStorage.getItem("lastY") == null){
			// init variable/set default variable for item
			var lastY = 0;
		} else {
			var lastY = localStorage.getItem("lastY");
		}

		var map = L.map('map', {
			crs: L.CRS.Simple,
		});

		var x1 = 0;
		//11765/100;
		var y1 = 0;
		//-10079/100;
		var x2 = 800;
		//-15891/100;
		var y2 = 800;
		//23282/100;
		
		var bounds = [[x1,y1], [x2, y2]];
		var image = L.imageOverlay('../static/images/floor_map.png').addTo(map);

		//map.setView([65.24751, 14.23828], 5);
		//var tiles = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
		//	attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
		//}).addTo(map);

		// addressPoints = addressPoints.map(function (p) { return [p[0], p[1]]; });
		// console.log(addressPoints);
		// var heat = L.heatLayer(addressPoints).addTo(map);
		//map.fitBounds(bounds);
		//map.setMaxBounds(bounds)

		map.on('click', function(e){
			var coord = e.latlng;
			var lat = coord.lat;
			var lng = coord.lng;
			console.log("You clicked the map at latitude: " + lat + " and longitude: " + lng);
		});
		
		// image dims
		w = 841;
		h = 982;
		var mapWidth=map._container.offsetWidth;
		var mapHeight=map._container.offsetHeight;
		

		function update(){
			$.getJSON(
				"{% url 'base:update' %}",	
				{},
				function (data) {
					console.log(mapWidth)
					console.log(mapHeight)
					console.log(data); // This is the json object
					x = data[2]['Reidar']['coord']['x']
					y = data[2]['Reidar']['coord']['y']
					if (!((lastX == 0)&&(lastY==0))) {
						var sol =([((x - lastX)/11.33), ((y-lastY)/17.37)]);
						L.marker(sol).addTo(map);
						localStorage.setItem("lastX", x);
						localStorage.setItem("lastY", y);
					} 
				
					setTimeout(update, 1000);
				}
			)
		}
		$(document).ready(
			update
		);
		map.setView([0,0], 1);
																							
	</script>
</body>

</html>

16300, 403


